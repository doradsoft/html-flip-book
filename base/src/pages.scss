.page {
  position: absolute;
  backface-visibility: hidden;
  transform-style: preserve-3d;
  // Every page is opaque by default (like paper). Without this, blank pages
  // (e.g. cover interiors) would be transparent and the other side of the leaf
  // would bleed through mirrored via the 3D transform.
  background: #fff;
  // Performance: isolate each page as an independent rendering island so the
  // browser can skip re-layout/repaint of page internals during 3D transforms.
  contain: layout style paint;
  --inner-shadow-shadow: 0;
  --inner-shadow-highlight: 0;
  --inner-shadow-edge: right;
}

.page::before,
.page::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  backface-visibility: hidden;
  transition: opacity 120ms ease;
  will-change: opacity;
}

// Inner shadow: simulates shadow cast by lifted page onto the page below
// - 0.35 opacity provides subtle but visible shadow
// - 40% gradient stop creates a soft fade matching natural shadow falloff
// NOTE: translateZ lift was removed because `contain: layout style paint`
// on .page creates a flattened stacking context that suppresses preserve-3d,
// making translateZ a no-op.  The gradient + opacity already produce the
// visual shadow effect.
.page::before {
  background: linear-gradient(
    to var(--inner-shadow-edge),
    rgba(0, 0, 0, calc(0.35 * var(--inner-shadow-shadow))) 0%,
    rgba(0, 0, 0, 0) 40%
  );
  opacity: var(--inner-shadow-shadow);
  mix-blend-mode: multiply;
}

// Edge highlight: simulates light catching the lifted page edge
// - 0.4 opacity balances visibility without washing out content
// - 45% gradient stop slightly wider than shadow for realistic light spread
.page::after {
  background: linear-gradient(
    to var(--inner-shadow-edge),
    rgba(255, 255, 255, calc(0.4 * var(--inner-shadow-highlight))) 0%,
    rgba(255, 255, 255, 0) 45%
  );
  opacity: var(--inner-shadow-highlight);
}

/* Disable shadow when prop pageShadow={false} (e.g. flicker workaround, issue #167). */
.flipbook--no-page-shadow .page::before,
.flipbook--no-page-shadow .page::after {
  opacity: 0 !important;
}

// Applied during flip animation when snapshotDuringFlip is enabled.
// The browser freezes the page rendering as a GPU texture; scrollbar chrome
// and text selection are hidden so the snapshot looks clean.
// overflow is NOT changed — scroll position is fully preserved.
.page--flipping {
  contain: strict;
  user-select: none;

  // Make scrollbar chrome invisible but PRESERVE gutter width.
  // Using scrollbar-color:transparent keeps the scrollbar's space allocated
  // so content doesn't reflow wider when the snapshot is taken.
  // scrollbar-color is standard (Firefox, Chrome 121+, Edge 121+).
  scrollbar-color: transparent transparent;
  // Safari/older WebKit: overlay scrollbars don't occupy space, so display:none
  // is safe — no content width shift on those platforms.
  &::-webkit-scrollbar { display: none; }

  * {
    scrollbar-color: transparent transparent !important;
    &::-webkit-scrollbar { display: none !important; }
  }
}

.page > * {
  // enforcing page direct children to not cause it to be overflowed
  max-width: 100%;
  max-height: 100%;
  // -----------------------------------------------------------------
  // enforce children to fill the page
  height: 100%;
  width: 100%;
  // ---------------------------------

  // anti-padding bad effects
  box-sizing: border-box;
}
